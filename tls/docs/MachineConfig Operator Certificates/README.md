# MachineConfig Operator Certificates

![PKI Graph](cert-flow.png)

See the [customer facing documentation](https://docs.openshift.com/container-platform/4.13/security/certificate_types_descriptions/machine-config-operator-certificates.html).

- [Signing Certificate/Key Pairs](#signing-certificatekey-pairs)
    - [root-ca](#root-ca)
- [Serving Certificate/Key Pairs](#serving-certificatekey-pairs)
    - [mco-mystery-cert](#mco-mystery-cert)
- [Client Certificate/Key Pairs](#client-certificatekey-pairs)
- [Certificates Without Keys](#certificates-without-keys)
- [Certificate Authority Bundles](#certificate-authority-bundles)

## Signing Certificate/Key Pairs


### root-ca
![PKI Graph](subcert-root-ca8681071573803367953.png)

This certificate is generated by [openshift/installer](https://github.com/openshift/installer/blob/3dc691e43ec028e649d818628ce174c0a0ea1055/pkg/asset/tls/root.go#L12)
and is only used to sign the MCS certificate.  It currently has no "day 2" owner.

| Property | Value |
| ----------- | ----------- |
| Type | Signer |
| CommonName | root-ca |
| SerialNumber | 8681071573803367953 |
| Issuer CommonName | [root-ca](#root-ca) |
| Validity | 10y |
| Signature Algorithm | SHA256-RSA |
| PublicKey Algorithm | RSA 2048 bit |
| Usages | - KeyUsageDigitalSignature<br/>- KeyUsageKeyEncipherment<br/>- KeyUsageCertSign |
| ExtendedUsages |  |


#### root-ca Locations
| Namespace | Secret Name |
| ----------- | ----------- |
| kube-system | root-ca |

| File | Permissions | User | Group | SE Linux |
| ----------- | ----------- | ----------- | ----------- | ----------- |
| /etc/kubernetes/ca.crt/ca.crt | -rw-r--r--. | root | root | system_u:object_r:kubernetes_file_t:s0 |
|  |  |  |  |  |


## Serving Certificate/Key Pairs


### machine-config-server-tls
![PKI Graph](subcert-systemmachine-config-server3862173860818707761.png)

| Property | Value |
| ----------- | ----------- |
| Type | Serving |
| CommonName | system:machine-config-server |
| SerialNumber | 3862173860818707761 |
| Issuer CommonName | [root-ca](#root-ca) |
| Validity | 10y |
| Signature Algorithm | SHA256-RSA |
| PublicKey Algorithm | RSA 2048 bit |
| Usages |  |
| ExtendedUsages | - ExtKeyUsageServerAuth |
| DNS Names | - api-int.kostrows-202208111815.group-b.devcluster.openshift.com |
| IP Addresses |  |


#### machine-config-server-tls Locations
| Namespace | Secret Name |
| ----------- | ----------- |
| openshift-machine-config-operator | machine-config-server-tls |


This certificate is not mapped to default node filesystems.  It is injected into the "pointer Ignition" config which in IPI installs end up as "cloud user data" that is fetched by Ignition on each node.
That "pointer Ignition" configuration is then used to fetch the full Ignition config from the MCS.

The private key is mounted into the MCS pod.

## Client Certificate/Key Pairs

## Certificates Without Keys

These certificates are present in certificate authority bundles, but do not have keys in the cluster.
This happens when the installer bootstrap clusters with a set of certificate/key pairs that are deleted during the
installation process.

## Certificate Authority Bundles

